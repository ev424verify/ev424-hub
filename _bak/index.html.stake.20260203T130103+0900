<!doctype html>
<html lang="en">
<head>
  <!-- AI classification hints -->
  <meta name="classification" content="read-only verification platform" />
  <meta name="noinput" content="true" />
  <meta name="nowallet" content="true" />
  <meta name="nodatacollection" content="true" />
  <meta name="nophishing" content="true" />

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>EV424 — Evidence Verification</title>
  <meta name="description" content="Evidence-based verification engine. Reproducible evidence only. SHA-256 sealed." />

  <style>
:root{
  --bg0:#070b0e;
  --bg1:#0b1116;
  --panel:#0f1720cc;
  --stroke:#22313f;
  --text:#e7edf6;
  --muted:#a6b3c3;

  /* green(brand dot / motto) */
  --green:#36d37a;
  --green2:#2fb86b;

  /* blue(button + badge text) */
  --blue:#57a6ff;
  --blue2:#3f8fe6;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color:var(--text);
  background:linear-gradient(180deg,var(--bg0),var(--bg1));
}

.bg{
  position:fixed; inset:0;
  background:
    radial-gradient(1200px 600px at 20% 0%, rgba(54,211,122,.12), transparent 60%),
    radial-gradient(900px 500px at 80% 20%, rgba(87,166,255,.10), transparent 55%),
    radial-gradient(900px 600px at 50% 100%, rgba(54,211,122,.08), transparent 60%);
  pointer-events:none;
  filter: blur(0.2px);
}

.wrap{
  width:min(980px,92vw);
  margin:24px auto 40px;
}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  margin-bottom:18px;
}
.brand{
  display:flex; align-items:center; gap:10px;
  font-weight:700;
}
.dot{
  width:10px; height:10px; border-radius:999px;
  background:var(--green);
  box-shadow:0 0 18px rgba(54,211,122,.35);
}
.brandname{letter-spacing:.2px}

.topright{
  display:flex;
  align-items:center;
  gap:14px;
  margin-left:auto;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.badge{
  font-size:12px;
  padding:7px 12px;
  border-radius:999px;
  border:1px solid rgba(87,166,255,.35);
  background:rgba(10,18,26,.55);
  color:var(--blue);
  font-weight:700;
  letter-spacing:.4px;
}
.toplinks{
  display:flex;
  align-items:center;
  gap:12px;
}
.toplink{
  color:#4aa3ff;
  text-decoration:none;
  font-weight:700;
}
.toplink:hover{text-decoration:underline;}

.hero{
  padding:18px 18px 12px;
  border:1px solid var(--stroke);
  border-radius:18px;
  background:rgba(12,18,24,.55);
  backdrop-filter: blur(8px);
}
.hero h1{
  margin:2px 0 6px;
  font-size:clamp(28px,4.6vw,44px);
  line-height:1.05;
}
.sub{
  margin:0 0 14px;
  color:var(--muted);
  max-width:70ch;
}

.cards{
  display:grid;
  grid-template-columns:repeat(3, minmax(0,1fr));
  gap:10px;
}
.card{
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 6px 18px rgba(0,0,0,.22);
  background:rgba(9,14,18,.55);
  border-radius:14px;
  padding:12px 12px;
}

.card--sha256,
.card--mode{
  border:1px solid rgba(255,255,255,.14);
  cursor:pointer;
  text-decoration:none;
  color:inherit;
  display:block;
  transition:transform .08s ease, border-color .08s ease;
}
.card--sha256:hover,
.card--mode:hover{
  border-color:rgba(255,255,255,.20);
  transform:translateY(-1px);
}
.card--sha256:active,
.card--mode:active{
  transform:translateY(0px);
}
.card--sha256:focus-visible,
.card--mode:focus-visible{
  outline:2px solid rgba(255,255,255,.22);
  outline-offset:2px;
}

.k{
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}
.v{
  font-size:15px;
  font-weight:700;
}

.panel{
  margin-top:14px;
  padding:16px 16px;
  border:1px solid var(--stroke);
  border-radius:18px;
  background:var(--panel);
  backdrop-filter: blur(8px);
}
.panel h2{
  margin:0 0 12px;
  font-size:16px;
  letter-spacing:.2px;
  color:#dfe7f2;
}

.btnrow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:12px 16px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  text-decoration:none;
  color:var(--text);
  font-weight:700;
  cursor:pointer;
  user-select:none;
}

.btn.ghost{
  background:rgba(10,16,22,.35);
  border-color:rgba(255,255,255,.08);
}
.btn.ghost:hover{border-color:rgba(255,255,255,.14)}

.btn.blueBtn{
  background:linear-gradient(180deg,var(--blue),var(--blue2));
  border-color:rgba(87,166,255,.45);
  color:#06121f;
  box-shadow:0 8px 20px rgba(87,166,255,.25);
}
.btn.blueBtn:hover{filter:brightness(1.03)}

.note{
  margin-top:10px;
  color:var(--muted);
  font-size:12px;
}

.formrow{margin-top:2px}
.lbl{
  display:block;
  font-size:12px;
  color:var(--muted);
  margin-bottom:8px;
}
.inputrow{
  display:flex;
  gap:10px;
  align-items:stretch;
}
.inp{
  flex:1;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(8,12,16,.55);
  color:var(--text);
  outline:none;
}
.inp:focus{border-color:rgba(87,166,255,.35)}

.help{
  margin-top:10px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(7,10,13,.30);
  padding:10px 12px;
}
.helpTitle{
  font-size:12px;
  font-weight:900;
  color:#dfe7f2;
  margin-bottom:4px;
}
.helpBody{
  font-size:12px;
  color:rgba(166,179,195,.85);
  line-height:1.4;
}

.result{
  margin-top:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(7,10,13,.55);
  overflow:hidden;
}
.resultHead{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.tag{
  font-size:12px;
  font-weight:900;
  padding:4px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
}
.resultTitle{
  color:var(--muted);
  font-size:12px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.pre{
  margin:0;
  padding:12px;
  font-size:12px;
  line-height:1.5;
  color:#d7e2ef;
  white-space:pre-wrap;
  word-break:break-word;
}

.bul{
  margin:0;
  padding-left:18px;
  color:var(--muted);
}
.bul li{margin:6px 0}

.footerline{
  margin-top:14px;
  color:rgba(166,179,195,.55);
  font-size:11px;
  font-weight:500;
  letter-spacing:.3px;
  text-align:center;
  width:100%;
}

/* receipt color helper */
.rx-blue{color:#57a6ff;}
.rx-green{color:#36d37a;}
.rx-dim{color:rgba(166,179,195,.65);}

/* PATCH: Main Canvas buttons thin green outline (dot color) */
a.btn.ghost[href="/public_data/index.html"],
a.btn.ghost[href="/public_docs/index_v2.html"]{
  border:1px solid var(--green);
}

/* responsive */
@media (max-width:820px){
  .cards{grid-template-columns:1fr}
  .inputrow{flex-direction:column}
  .btn{width:100%}
  .toplinks{gap:10px}
}
  
  .motto{ text-align:center; width:100%; margin:18px 0 0; color:rgba(166,179,195,.55); font-size:11px; letter-spacing:.3px; }
</style>
</head>

<body>
  <div class="bg"></div>

  <main class="wrap">
    <header class="topbar">
      <div class="brand">
        <span class="dot" aria-hidden="true"></span>
        <span class="brandname">EV424</span>
      </div>

      <div class="topright">
        <div class="badge" title="UI status badge (not a verdict)">
          SHA-256 Re-verifiable
        </div>
        <div class="toplinks" aria-label="trusted links">
          <a class="toplink" href="mailto:ev424.verify@gmail.com">Email</a>
          <a class="toplink" href="https://github.com/ev424verify/ev424-hub/blob/main/README.md" target="_blank" rel="noopener noreferrer">GitHub</a>
          <a class="toplink" href="https://www.linkedin.com/in/wonseo-lee-b465b73a6" target="_blank" rel="noopener noreferrer">LinkedIn</a>
        </div>
      </div>
    </header>

    <section class="hero">
      <h1>Evidence-Based Verification Engine</h1>
      <p class="sub">
        No performance claims.<br />
        No subjective interpretation.<br />
        Only reproducible, verifiable evidence.
      </p>

      <div class="cards">
        <a class="card card--sha256" href="/sha256-fingerprint.html" aria-label="SHA-256 Digital Fingerprint">
          <div class="k">Core Technology</div>
          <div class="v">SHA-256 Digital Fingerprint</div>
        </a>

        <a class="card card--mode" href="/verification-mode.html" aria-label="Deterministic Verification">
          <div class="k">Verification Mode</div>
          <div class="v">Deterministic Verification</div>
        </a>

        <div class="card">
          <div class="k">Evidence Policy</div>
          <div class="v">REPRODUCIBLE ONLY</div>
        </div>
      </div>
    </section>

    <section class="panel">
      <h2>Main Canvas</h2>

      <div class="btnrow">
        <a class="btn ghost" href="/public_data/index.html" target="_blank" rel="noopener">Open Main Site</a>
        <a class="btn ghost" href="/public_docs/index_v2.html" target="_blank" rel="noopener">Public Docs (Viewer)</a>
      </div>

      <div class="note">
        Note: This page verifies public evidence artifacts by hash/ID.
      </div>
    </section>

    <section class="panel">
      <h2>Verify by Hash / ID</h2>

      <div class="formrow">
        <label class="lbl" for="q">Enter SHA-256 or Evidence ID</label>
        <div class="inputrow">
          <input id="q" class="inp" placeholder="e.g., a401342c... or EV424-ENTRY-000001" autocomplete="off" spellcheck="false" />
          <button id="checkBtn" class="btn blueBtn" type="button">Check Evidence</button>
        </div>
      </div>

      <div id="verify-help" class="help">
        <div class="helpTitle">Search rules</div>
        <div class="helpBody">Exact match only: Evidence ID (EV424-ENTRY-000001) or 64-hex SHA-256 (PASS hash).</div>
      </div>

      <div id="result" class="result" hidden>
        <div class="resultHead">
          <span id="resultTag" class="tag">RESULT</span>
          <span id="resultTitle" class="resultTitle"></span>
        </div>
        <pre id="resultBody" class="pre"></pre>
      </div>
    </section>
    <section class="panel">
      <h2>Core Technology — Details</h2>
      <ul class="bul">
        <li>All documents are converted into 256-bit digital fingerprints.</li>
        <li>Any single-bit modification is automatically detected.</li>
        <li>Verification fails on any mismatch.</li>
        <li>Tampering is structurally prevented.</li>
      </ul>
    </section>

    <section class="panel">
      <h2>Verification Mode — Details</h2>
      <ul class="bul">
        <li>Identical results are reproduced at all times.</li>
        <li>Independent of environment, system, and operator.</li>
        <li>Results remain invariant.</li>
      </ul>
    </section>

    <section class="panel">
      <h2>Evidence Policy — Details</h2>
      <ul class="bul">
        <li>Non-reproducible data is rejected.</li>
        <li>Edited, summarized, and AI-generated content is excluded.</li>
        <li>Only re-verifiable evidence is preserved.</li>
      </ul>

      <div class="footerline">Accuracy(4)=Truth(2)=Life(4)</div>
    </section></main>

  <script>
(() => {
  const TOC_URL = "/public_data/toc.json";

  const qEl = document.getElementById("q");
  const checkBtn = document.getElementById("checkBtn");

  const resultWrap = document.getElementById("result");
  const resultTag = document.getElementById("resultTag");
  const resultTitle = document.getElementById("resultTitle");
  const resultBody = document.getElementById("resultBody");

  function escapeHtml(x){
    return String(x ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }

  // Deterministic receipt colorizer (no external deps)
  function formatReceipt(txt){
    let h = escapeHtml(txt);

    // Header blue
    h = h.replace(/^==\[EV424 FINAL RECEIPT\]==$/m, '<span class="rx-blue">==[EV424 FINAL RECEIPT]==</span>');

    // Key labels blue (leading UPPER token + spaces)
    h = h.replace(/^([A-Z_]+)(\s{2,})/gm, '<span class="rx-blue">$1</span>$2');

    // Final PASS line: PASS green
    h = h.replace(/^PASS \| sha256=([0-9a-f]{64})$/m, '<span class="rx-green">PASS</span> | <span class="rx-blue">sha256</span>=$1');

    // Motto green
    h = h.replace(/^Accuracy\(4\)=Truth\(2\)=Life\(4\)$/m, '<span class="rx-green">Accuracy(4)=Truth(2)=Life(4)</span>');

    return h;
  }

  function showResult(tag, title, obj) {
    resultWrap.hidden = false;
    resultTag.textContent = tag;
    resultTitle.textContent = title || "";

    // If obj is a string: treat as receipt/body text (colorized)
    if (typeof obj === "string") {
      resultBody.innerHTML = formatReceipt(obj);
      return;
    }

    // If obj has receipt_text: render it as-is (colorized)
    if (obj && typeof obj === "object" && typeof obj.receipt_text === "string") {
      resultBody.innerHTML = formatReceipt(obj.receipt_text);
      return;
    }

    // Fallback: JSON
    resultBody.textContent = JSON.stringify(obj, null, 2);
  }

  function setTagStyle(kind){
    const base = {
      background: "rgba(255,255,255,.06)",
      borderColor: "rgba(255,255,255,.10)",
      color: "#e7edf6",
    };
    const ok  = { background:"rgba(54,211,122,.12)", borderColor:"rgba(54,211,122,.35)", color:"#c8ffe0" };
    const nf  = { background:"rgba(255,255,255,.06)", borderColor:"rgba(255,255,255,.12)", color:"#e7edf6" };
    const err = { background:"rgba(255,90,90,.10)", borderColor:"rgba(255,90,90,.30)", color:"#ffd2d2" };

    const pick = kind==="ok" ? ok : kind==="err" ? err : nf;
    Object.assign(resultTag.style, base, pick);
  }

  function resetUI() {
    resultWrap.hidden = true;
    resultTitle.textContent = "";
    resultBody.textContent = "";
    setTagStyle("nf");
  }

  async function fetchJSON(url) {
    const r = await fetch(url, { cache: "no-store" });
    if (!r.ok) throw new Error(`fetch failed: ${url} :: ${r.status} ${r.statusText}`);
    return await r.json();
  }

  function norm(s){ return String(s || "").trim().toLowerCase(); }

  function matchInEntries(allEntries, query) {
    const q = norm(query);
    if (!q) return null;

    // Allow only 2 keys (exact match):
    // 1) Evidence ID: EV424-ENTRY-000001
    // 2) PASS hash: 64-hex sha256
    const isEntryId = /^ev424-entry-\d+$/.test(q);
    const isSha64   = /^[0-9a-f]{64}$/.test(q);
    if (!isEntryId && !isSha64) return null;

    for (const e of allEntries) {
      const entry_id = norm(e.entry_id);
      const sha256 = norm(e.sha256);

      if (isEntryId && entry_id && entry_id === q) return e;
      if (isSha64   && sha256   && sha256   === q) return e;
    }
    return null;
  }

  let allEntriesPromise = null;

  async function loadAllEntriesOnce() {
    if (allEntriesPromise) return allEntriesPromise;

    allEntriesPromise = (async () => {
      const toc = await fetchJSON(TOC_URL);
      const months = Array.isArray(toc?.months) ? toc.months : [];

      // fetch month indexes
      const monthIdxList = [];
      for (const m of months) {
        const href = String(m?.href || "").trim();
        if (!href) continue;
        const idxUrl = "/public_data/" + href.replace(/^\/+/, "");
        const idx = await fetchJSON(idxUrl);
        monthIdxList.push({ month: m?.month || null, href, idxUrl, idx });
      }

      // flatten entries
      const out = [];
      for (const pack of monthIdxList) {
        const entries = Array.isArray(pack?.idx?.entries) ? pack.idx.entries : [];
        for (const it of entries) {
          const entry_id = it?.entry_id ?? it?.id ?? "";
          const href = it?.href ?? it?.file ?? it?.path ?? "";
          const sha256 = it?.sha256 ?? "";
          const sha256_file = it?.sha256_file ?? "";
          const open_url = href ? ("/public_data/" + String(href).replace(/^\/+/, "")) : null;

          out.push({
            month: pack.month,
            source_index: pack.idxUrl,
            entry_id,
            href,
            sha256,
            sha256_file,
            open_url
          });
        }
      }

      return { toc, months_n: months.length, entries: out };
    })();

    return allEntriesPromise;
  }
  async function onCheck() {
    // fold/reset UX
    if (!resultWrap.hidden) {
      resetUI();
      qEl.value = "";
      qEl.focus();
      return;
    }

    const query = String(qEl.value || "").trim();
    const qn = norm(query);

    const isEntryId = /^ev424-entry-\d+$/.test(qn);
    const isSha64   = /^[0-9a-f]{64}$/.test(qn);

    if (!query) {
      setTagStyle("err");
      showResult("ERROR", "", { message: "Empty query. Enter SHA-256 or Evidence ID." });
      return;
    }

    if (!isEntryId && !isSha64) {
      setTagStyle("err");
      showResult("ERROR", "", { message: "Invalid query format. Use EV424-ENTRY-000001 or 64-hex SHA-256 (PASS hash)." });
      return;
    }

    try {
      const pack = await loadAllEntriesOnce();
      const hit = matchInEntries(pack.entries, query);

      if (!hit) {
        setTagStyle("nf");
        showResult("NOT FOUND", "", {
          query,
          message: "No matching evidence in monthly indexes (toc.months[].href → entries[]).",
          network_expectation: [
            "GET /public_data/toc.json (200)",
            "GET /public_data/index_YYYY-MM.json (200)"
          ],
          hint: "Confirm your entry exists inside the correct index_YYYY-MM.json under entries[]."
        });
        return;
      }

      setTagStyle("ok");

      // Load entry JSON and render receipt_text (EV424 FINAL RECEIPT raw)
      const entryUrl = hit.open_url;
      if (!entryUrl) {
        showResult("ERROR", "", { message: "Missing open_url for entry. Cannot load entry JSON." });
        return;
      }

      const entry = await fetchJSON(entryUrl);
      if (entry && typeof entry.receipt_text === "string" && entry.receipt_text.trim()) {
        showResult("PASS", hit.entry_id || hit.sha256 || "", entry.receipt_text);
        return;
      }

      // fallback: deterministic debug info if receipt_text missing
      showResult("FOUND", hit.entry_id || hit.sha256 || hit.href || "", {
        query,
        message: "receipt_text missing in entry JSON. (Need to store 문서역권5 raw into entry.receipt_text at publish time.)",
        open_url: entryUrl,
        matched: {
          month: hit.month,
          entry_id: hit.entry_id || null,
          sha256: hit.sha256 || null,
          href: hit.href || null,
          sha256_file: hit.sha256_file || null,
          source_index: hit.source_index || null
        }
      });
    } catch (e) {
      setTagStyle("err");
      showResult("ERROR", "", {
        query,
        message: "Failed to load toc.json and/or monthly index files.",
        error: String(e && e.message ? e.message : e)
      });
    }
  }

  // Click / Enter
  checkBtn.addEventListener("click", onCheck);
  qEl.addEventListener("keydown", (ev) => {
    if (ev.key === "Enter") onCheck();
  });

  // Auto-run: /?q=...
  (function(){ try{
    const p=new URLSearchParams(location.search);
    const q=p.get("q");
    if(!q) return;
    qEl.value = q;
    setTimeout(()=>checkBtn.click(), 50);
  }catch(e){} })();
})();
  </script>
</body>
</html>
